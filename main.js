(()=>{"use strict";var e={inputSelector:".form__item",buttonSelector:".form__submit-button",formSelector:".form",invalidTextClass:"form__item_invalid"},t={},n=document.getElementById("pop-up_deletion"),r={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"7da61f33-1d7f-460e-844f-4b16d0869fbe","Content-Type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status,"."))},c=function(e){console.log(e)},u=function(e,t){e.textContent=t},a=document.querySelectorAll(".pop-up__close-button"),i=document.getElementById("pop-up_card"),l=i.querySelector(".pop-up__image"),s=i.querySelector(".pop-up__heading"),d=document.querySelectorAll(".pop-up");function m(e){e.classList.remove("pop-up_opened"),e.removeEventListener("keydown",f)}function f(e){"Escape"===e.key&&m(document.querySelector(".pop-up_opened"))}function p(e){e.classList.add("pop-up_opened"),e.addEventListener("keydown",f),e.focus()}function h(e,t){var n="error-"+e.id;document.getElementById(n).textContent="",e.classList.remove(t.invalidTextClass)}function _(e){e.disabled=!1}function v(e){e.disabled=!0}function b(e,t){var n=e.querySelector(t.buttonSelector);v(n),e.querySelectorAll(t.inputSelector).forEach((function(r){r.addEventListener("input",(function(){(function(e,t){e.validity.valid?h(e,t):function(e,t,n){var r="error-"+e.id;document.getElementById(r).textContent=t,e.classList.add(n.invalidTextClass)}(e,e.validationMessage,t)})(r,t),function(e,t){e.checkValidity()?_(t):v(t)}(e,n)}))}))}a.forEach((function(e){var n=e.closest(".pop-up");e.addEventListener("click",(function(e){"pop-up_deletion"===n.id&&(t.markup="",t._id=""),m(n)}))})),d.forEach((function(e){e.addEventListener("mousedown",(function(t){return function(e,t){e.target.classList.contains("pop-up")&&m(t)}(t,e)}))}));var k=function(e,t){e.querySelectorAll("input").forEach((function(e){return h(e,t)})),v(e.querySelector(t.buttonSelector))},y=document.getElementById("template-element").content.querySelector(".element");function S(u,a,d){var m={};m._id=d,m.markup=y.cloneNode(!0);var f=m.markup.querySelector(".element__heading"),h=m.markup.querySelector(".element__image");return m.buttonLike=m.markup.querySelector(".element__like-button"),m.buttonDelete=m.markup.querySelector(".element__delete-button"),m.likeCounter=m.markup.querySelector(".element__like-counter"),f.textContent=u,h.setAttribute("src",a),h.setAttribute("alt",u),m.buttonDelete.addEventListener("click",(function(r){t._id=d,t.markup=m.markup,_(n.querySelector(e.buttonSelector)),p(n)})),m.buttonLike.addEventListener("click",(function(e){var t;m.buttonLike.classList.contains("element__like-button_checked")?function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{headers:r.headers,method:"DELETE"})}(m._id).then(o).then((function(t){m.likes=t.likes,m.likeCounter.textContent=m.likes.length,e.target.classList.remove("element__like-button_checked")})).catch(c):(t=m._id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{headers:r.headers,method:"PUT"})).then(o).then((function(t){m.likes=t.likes,m.likeCounter.textContent=m.likes.length,e.target.classList.add("element__like-button_checked")})).catch(c)})),h.addEventListener("click",(function(e){!function(e,t){l.setAttribute("src",t),l.setAttribute("alt",e),s.textContent=e}(u,a),p(i)})),m}var E,q=document.querySelector(".elements__list"),L=document.querySelector(".profile__add-button"),g=document.getElementById("pop-up_element"),C=g.querySelector(e.buttonSelector),x=document.forms["form-element"],A=x.querySelector('input[name="name"]'),T=x.querySelector('input[name="link"]'),U=document.querySelector(".profile__edit-button"),D=document.getElementById("pop-up_profile"),I=D.querySelector('input[name="name"]'),B=D.querySelector('input[name="about"]'),w=document.forms["form-profile"],P=document.querySelector(".profile__username"),N=document.querySelector(".profile__user-about"),O=document.querySelector(".profile__avatar-container"),j=document.querySelector(".profile__avatar"),J=document.getElementById("pop-up_avatar"),H=document.forms["form-avatar"],z=H.elements["avatar-link"],M="",V=n.querySelector(".form");function F(e){q.prepend(e)}function G(e,t,n){P.textContent=e,N.textContent=t,void 0===n||(j.src=n)}E=e,document.querySelectorAll(E.formSelector).forEach((function(e){b(e,E)})),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(o).then((function(e){G(e.name,e.about,e.avatar),M=e._id})).then((function(){return fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers})})).then(o).then((function(e){e.forEach((function(e){var t=S(e.name,e.link,e._id);t.likes=e.likes,t.likeCounter.textContent=t.likes.length,t.likes.findIndex((function(e){return e._id===M}))>-1&&t.buttonLike.classList.add("element__like-button_checked"),e.owner._id!==M&&t.buttonDelete.remove(),F(t.markup)}))})).catch(c),L.addEventListener("click",(function(e){return p(g)})),x.addEventListener("submit",(function(e){var t,n;u(e.submitter,"Создание..."),e.preventDefault(),(t=A.value,n=T.value,fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers,method:"POST",body:JSON.stringify({name:t,link:n})})).then(o).then((function(t){F(S(t.name,t.link,t._id).markup),m(g),e.target.reset(),v(C)})).catch(c).finally((function(t){return u(e.submitter,"Создать")}))})),U.addEventListener("click",(function(t){I.value=P.textContent,B.value=N.textContent,k(w,e),p(D)})),w.addEventListener("submit",(function(e){var t,n;u(e.submitter,"Сохранение..."),e.preventDefault(),(t=I.value,n=B.value,fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers,method:"PATCH",body:JSON.stringify({name:t,about:n})})).then(o).then((function(e){G(e.name,e.about),m(D)})).catch(c).finally((function(t){return u(e.submitter,"Сохранить")}))})),O.addEventListener("click",(function(e){return p(J)})),H.addEventListener("submit",(function(t){var n;u(t.submitter,"Сохранение..."),t.preventDefault(),(n=z.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{headers:r.headers,method:"PATCH",body:JSON.stringify({avatar:n})})).then(o).then((function(n){j.src=n.avatar,m(J),t.target.reset(),k(t.target,e)})).catch(c).finally((function(e){return u(t.submitter,"Сохранить")}))})),V.addEventListener("submit",(function(e){var a;e.preventDefault(),u(e.submitter,"Удаление..."),(a=t._id,fetch("".concat(r.baseUrl,"/cards/").concat(a),{headers:r.headers,method:"DELETE"})).then(o).then((function(e){return t.markup.remove()})).catch(c).finally((function(r){t.markup="",t._id="",m(n),u(e.submitter,"Да")}))}))})();